# 게임 취약점 진단
게임 진단은 개발 방법을 이해하고 접근해야 수월하며 자체 엔진을 제외하고 크게 언리얼, 유니티로 나뉨
본 문서는 실제 안티 치트 (배틀아이, NGS, Xigncode 구버전/신버전 등)의 대한 내용은 기술 및 공유하지 않으며
게임 취약점 진단 컨설팅 수행 시 언리얼 유니티 엔진에 대한 진단 방법을 서술함.

# 게임 취약점 진단 공격 포인트 크게 3가지
1.클라이언트 측 리소스, 재화, 메모리 변조를 통한 어뷰징(데미지, 이속, 구매 bypass등)
2.다운로드 서버, 패치 서버에 접근 시 노출되는 정보를 통해 침투 가능성 및 개발자 버전 다운로드 가능 여부 등
3.로그인 등 인증 서버에 요청 변조를 통한 우회

# 동일한 엔진으로 배포 시 플랫폼별로 진단해야 할까?
플랫폼 마다 별도의 서버를 두거나 컨텐츠(기능)가 다른 경우가 아닌 이상
게임 기능을 악용하는데 있어서는 플랫폼별 진단은 필수 사항은 아님.
하지만 동일한 엔진에서 배포 시 노출되는 정보가 다르고 실수로 개발자 버전을 배포하는 등(실제 사례 존재)
취약점은 존재하기 때문에 보안의 수준을 판단하기 위해서는 플랫폼마다 진단하는 것이 옳음

# 언리얼 엔진 진단 준비물(PC기준, 5.5.4 등 최신 버전 기준)
메모리 변조/분석 툴, 디버거 : Cheat Engine , windbg, x64dbg, Frida 등
리버싱 툴 : IDA, Ghidra 
진단 대상 게임 버전에 맞는 언리얼 : 에픽게임즈 런처, Github Unreal source code
네트워크 패킷 툴 : WireShark
리소스 분석 툴 :Fmodel
언리얼 엔진 전용 해킹 툴 : UEDumper, UE4SS
(해당 툴은 언리얼 최신 버전에서는 에러가 발생할 수 있음)

# 언리얼 엔진 진단 방법론 우선 순위 추천
## 1. UE4SS -> UEDumper(+ 콘솔 활성화)
해당 툴은 언리얼 진단 시 가장 먼저 시도함이 좋으나
5.5 이상의 버전으로 빌드된 게임에서는 제대로 작동하지 않으며
GName, GObject, UWorld 등의 전역 변수,함수의 Offset을 찾고
수동으로 Array Of Byte를 입력해야함
동일한 버전의 소스 코드를 통해 위치 값을 분석 후 
SigMaker로 시그니처 생성(AoB)
해당 툴 사용이 가능하면 모든 객체(클래스)와 함수의 값을 실시간 변조가 가능함.(LiveEditor)
또한 콘솔 활성화를 통해 개발자가 심어놓은 기능이 있는지 파악해야함.

## 2. 메모리 덤프, 디버깅을 통한 분석
해당 방법은 진단용 PDB 파일의 존재유무에 따라 나눠짐.
PDB 파일이 있을 경우 심볼 정보를 통해 함수 추출 후 Damage, ~~Calc, hit 등
진단 항목에 맞는 함수명을 검색하고 해당 offset을 확보할 수 있음

하지만 실제 해커 입장에서는 pdb파일이 없으며 메모리 분석을 통해 어뷰징해야함.
여러가지 방법이 있지만 이 글에서는 1개만 서술함.
UCharacterMovementComponent와 같이 엔진에서 기본적으로 사용되는 함수의 경우
IDE로 같은 버전 빌드 후 AOB 확보가 가능함.
Frida로 메모리에서 AOB 스캔 후 OFFSET을 확보하면 심볼 없이도 정확한 함수 위치를 파악하고 정교한 변조가 가능함.

또한 대부분의 값은 float, double로 xmm 레지스터에 저장되지만
특정 게임의 경우 소수 값을 제거하여 R8,R9 등의 레지스터에 저장되므로 둘다 봐야함.

## 3. 리소스 분석
Fmodel을 통해 리소스 분석이 가능함.
다만 AES 암호화가 걸려있을 경우 AES 후킹을 통해 올라오는 시점 확보 후 크랙이 가능함.
(DRM 여부에 따라서 추출 난이도가 급변함)
싱글 게임의 경우 이미지나 영상 파일 변조를 하는 경우가 많지만,
Path를 통해 루아 스크립트 후킹에 대한 필요한 정보를 얻을 수 있음.

## 4.기타 (네트워크 패킷 분석, 인증 인가 우회, 다운로드 서버 침투)
해당 방법은 웹,앱 진단과 동일함.
다운로드 시 GET 패킷에서 요청 값이 DATA/날짜/버전_게임이름명 식으로 되어 있을 경우
DEV/날짜/버전_게임이름명 등으로 변조하여 다운이 가능한지 체크해야하며 
포트 스캔 및 OS 취약점을 통해 침투가 가능한지 보안 관점에서 다각도로 살펴봐야함.

# 유니티 엔진 게임 진단 방법
언리얼 엔진과 다른점은 게임 데이터 로드 시점이 다를 수 있다는 점이며
대부분의 게임이 안티 치트가 올라온 뒤 클라이언트 내 로그인 후 기능이 로드됨.
빌드 방식에는 IL2CPP, MONO가 있으며 요즘 많이 사용하는 IL2CPP만 기술함.
(MONO의 난독화가 없으면 DLL 분석으로 쉽게 가능하기 때문)

# 유니티 엔진 진단 준비물(PC기준)
메모리 변조/분석 툴, 디버거 : Cheat Engine , windbg, x64dbg, Frida 등
리버싱 툴 : IDA, Ghidra 
진단 대상 게임 버전에 맞는 언리얼 : 에픽게임즈 런처, Github Unreal source code
네트워크 패킷 툴 : WireShark
리소스 분석 툴 : dllspy , AssetRipper
언리얼 엔진 전용 해킹 툴 : Il2CppDumper(에러 시 수동으로 offset 입력 필요)

# 언리얼 엔진 진단 방법론 우선 순위 추천
## 1. Cheat Engine MONO 기능 사용
해당 프로세스 Attach 후 MONO 스크립트를 클래스/함수명 및 OFFSET 위치를 알 수 있음.
일반적으로 값 변조도 가능하지만 필자가 진단한 게임의 경우 
난독화 솔루션으로 인해 값 변조 시 크래쉬 발생하였음.

## 2. 메모리 덤프, 디버깅을 통한 분석
Il2CppDumper를 활용하여 덤프 후 dnspy를 통해 Assembly-CSharp.dll 파일을 분석함.
해당 파일은 실제 코드가 C#으로 컴파일된 DLL이므로 게임 로직에 대한 전반적인 기능을 가지고 있음.
DLL에서 OFFSET 추출이 가능하며 얻은 정보를 통해 디버깅/Frida 후킹이 가능함.

해당 방식이 불가능하면 scylla dumper로 덤프 후 IDA로 분석하여 AOB 매칭을 통해 변조할 함수를 찾아 가야함.

## 3. 리소스 분석
MonoBehaviour 클래스를 통해 구조 파악 가능

## 4.기타 (네트워크 패킷 분석, 인증 인가 우회, 다운로드 서버 침투)
언리얼 엔진과 동일하게 수행 가능.
